
<!DOCTYPE html>
<html>
<head>
  <!--
    Kilsbergen MkDocs theme copyright 2019 Ruud van Asseldonk.
    Licensed under the Apache 2.0 license.
    See https://github.com/ruuda/kilsbergen.
  -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Building — Noblit</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500" rel="stylesheet">
  <style>
  /* The Inter font family, see https://rsms.me/inter.
     https://rsms.me/inter/#faq-cdn suggests that linking these files directly is fine.
  */
  @font-face {
    font-family: Inter;
    font-style:  normal;
    font-weight: 400;
    src: url("https://rsms.me/inter/font-files/Inter-Regular.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-Regular.woff?v=3.11") format("woff");
  }
  @font-face {
    font-family: Inter;
    font-style:  italic;
    font-weight: 400;
    src: url("https://rsms.me/inter/font-files/Inter-Italic.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-Italic.woff?v=3.11") format("woff");
  }
  @font-face {
    font-family: Inter;
    font-style:  normal;
    font-weight: 500;
    src: url("https://rsms.me/inter/font-files/Inter-Medium.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-Medium.woff?v=3.11") format("woff");
  }
  @font-face {
    font-family: Inter;
    font-style:  normal;
    font-weight: 600;
    src: url("https://rsms.me/inter/font-files/Inter-SemiBold.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-SemiBold.woff?v=3.11") format("woff");
  }
  @font-face {
    font-family: Inter;
    font-style:  normal;
    font-weight: 700;
    src: url("https://rsms.me/inter/font-files/Inter-Bold.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-Bold.woff?v=3.11") format("woff");
  }
  /* Modular scale with exponent 1.7^(1/3). The 1.7 was chosen as the line hight
     that goes well with Inter. Previously I used 1.59, but it was just too tight.
     0.59em
     0.70em
     1.00em
     1.19em
     1.42em
     1.70em
     2.02em
     2.42em
  */
  * { margin: 0; padding: 0; border-spacing: 0; }
  html {
    font-family: Inter, Roboto, sans-serif;
    /*
    Turn on character variant 8 for Inter, which puts serifs on the uppercase I.
    Also turn on variant 1, which has a curved 1.
    Disable contextual alternates for now. There is a bug, either in Inter or
    in Chrome (https://crbug.com/1046095) that causes colons after a <strong> to
    be raised above the baseline.
    */
    font-feature-settings: 'cv01' 1, 'cv08' 1, 'calt' 0;

    font-size: 16px;
    line-height: 1.7em;
    background-color: #fff;
    height: 100%;
  }
  body {
    height: 100%;
  }
  #content {
    display: grid;
    grid-template-columns: auto 16rem 50rem auto;
    color: #333;
    min-height: 100%;
  }
  #main {
    grid-area: 1 / 3 / 2 / 4;
    padding: 2.2rem;
    padding-left: 4rem;
    padding-right: 4rem;
    overflow: hidden;
  }
  #breadcrumbs {
    margin-bottom: 3rem;
    word-spacing: 0.3em;
    color: #78a;
  }
  #breadcrumbs a {
    word-spacing: 0;
    color: #78a;
  }
  article {
    margin-top: 1.3rem;
  }
  h1, h2, h3 {
    font-weight: 600;
    font-size: 1rem;
    color: #444;
  }
  h1 {
    font-size: 2rem;
    margin-bottom: 2.1rem;
  }
  h2 {
    font-size: 1.42rem;
    margin-top: 3.5rem;
    margin-bottom: 1.6rem;
  }
  code {
    font-family: 'Roboto Mono', monospace;
    font-size: 0.84rem;
    line-height: 1.5rem;
  }
  h3 > code {
    /* Roboto Mono 500 is about as heavy as Inter semibold (600). */
    font-weight: 500;
  }
  abbr {
    text-transform: uppercase;
    /* Downsize so caps are x-height, and compensate weight loss. */
    font-size: 0.78rem;
    font-weight: 500;
    letter-spacing: 0.05rem;
    /* Prevent abbrs from changing the line height of lines in which they occur. */
    line-height: 0;
  }
  sub, sup {
    /* Don't disturb the line height of normal text. */
    line-height: 0rem;
    font-size: 0.78rem;
    font-weight: 500;
  }
  p > code,
  a > code,
  h3 > code,
  li > code,
  td > code,
  dt > code,
  dd > code {
    background-color: #f0f0f0;
    padding: 0.13rem;
    padding-left: 0.3rem;
    padding-right: 0.3rem;
    border-radius: 0.2rem;
    line-height: 1rem;
  }
  h3 {
    padding-top: 0.9rem;
    padding-bottom: 0.8rem;
  }
  h3 > code {
    margin-left: -0.1rem;
  }
  a {
    color: #36d;
    text-decoration: none;
  }
  p, ul, ol, dl, pre, table {
    /* Same space as line height, leave exactly one line blank. */
    margin-bottom: 1.7rem;
  }
  pre {
    padding-top: 0.8rem;
    padding-bottom: 0.9rem;
    padding-left: 1.19rem;
    padding-right: 0;
    background-color: #f8f8f8;
    border-radius: 0 0.2rem 0.2rem 0;
    border-left: 0.3rem solid #d5d8e0;
    overflow-x: auto;
  }
  pre > code {
    margin-right: 1.41rem;
    color: #555;
  }
  ul, ol {
    list-style-type: none;
    counter-reset: item;
  }
  table {
    font-variant-numeric: tabular-nums;
  }
  th, td {
    padding-right: 2rem;
  }
  th {
    text-align: left;
  }
  td > img {
    display: block;
    padding-top: 1em;
    padding-bottom: 1em;
  }
  dl {
    display: grid;
    grid-template-columns: 1fr 4fr;
    grid-column-gap: 2em;
  }
  dl dt {
    text-align: right;
  }
  #main ul li:before {
    color: #555;
    content: '\2022';
    display: inline-block;
    font-weight: 700;
    margin-left: -0.9rem;
    width: 0.9rem;
  }
  #main ul li {
    margin-left: 0.87rem;
  }
  #main ol li:before {
    content: counter(item);
    display: inline-block;
    font-weight: 700;
    width: 0.8rem;
    margin-left: -1.6rem;
    padding-right: 0.8rem;
  }
  #main ol li {
    margin-left: 1.6rem;
    counter-increment: item;
  }
  #nav-prev-next {
    margin-top: 3.4rem;
    padding-bottom: 3.3rem;
  }
  #nav-prev, #nav-next, #repo-link {
    display: inline-block;
  }
  #nav-prev {
    float: left;
  }
  #nav-next, #repo-link {
    float: right;
    text-align: right;
  }
  #nav-prev::before {
    content: '\219e';
    padding-right: 0.5em;
  }
  #nav-next::after {
    content: '\21a0';
    padding-left: 0.5em;
  }
  aside {
    grid-area: 1 / 1 / 2 / 3;
    border-right: 1px solid #eee;
    background-color: #fafafa;
    color: #78a;
  }
  aside nav {
    margin-top: 9rem;
    padding-bottom: 3.4rem;
    width: 14rem;
    float: right;
    /* Put the active chapter border over the sidebar border. */
    margin-right: -1px;
  }
  aside a {
    color: inherit;
  }
  aside .toc-section {
    font-weight: 700;
  }
  aside ul {
    margin-bottom: 0;
  }
  aside li {
    overflow: hidden;
    text-overflow: ellipsis;
  }
  aside li ul {
    padding-top: 0.6rem;
    padding-bottom: 1.1rem;
  }
  aside li.toc-section {
    margin-top: 1.7rem;
  }
  aside li.toc-section {
    color: #36d;
  }
  aside li.current, aside li ul {
    border-right: 0.3em solid #d5d8e0;
    padding-left: 1em;
    margin-left: -1em;
  }
  aside li.toc-chapter.current {
    font-weight: 600;
  }
  aside li.toc-heading {
    padding-left: 1em;
  }

  @media(max-width: 63rem)
  {
    #content {
      /* Manual implementation of max-width: on narrower viewports,
         auto-size the body. */
      grid-template-columns: 0 16rem auto 0;
    }
  }

  @media(max-width: 1150px)
  {
    html { font-size: 15px; }
  }

  /* Move the sidebar TOC below content at small widths. */
  @media(max-width: 800px)
  {
    #content {
      display: block;
    }
    aside {
      border-top: 1px solid #eee;
      border-right: 0px none;
      padding-top: 1.7em;
    }
    aside nav {
      margin-left: 4em;
      margin-top: 1.7em;
      margin-right: 0;
      float: none;
      width: auto;
    }
    #main {
      padding-bottom: 1.7em;
    }
    /* Now that the TOC is full-width, adding the border on the right to
       highlight the active page is not as clear anymore, it can be far away.
       The current chapter is still in boldface, but that does not work for
       section indexes. So point a guillemet at it as well. */
    aside li.current, aside li ul {
      border-right: 0px none;
      position: relative;
    }
    aside li.current:before {
      content: '\203a';
      position: absolute;
      left: 0;
    }
  }

  /* Use less generous margins for very narrow viewports. */
  @media(max-width: 650px)
  {
    #main {
      padding-left: 2rem;
      padding-right: 2rem;
    }
    aside nav {
      margin-left: 2rem;
      padding-bottom: 2rem;
    }
  }

  @media(max-width: 450px)
  {
    #main {
      padding-left: 1.7em;
      padding-right: 1.7em;
    }
    aside nav {
      margin-left: 1.7em;
    }
  }
  </style>
</head>
<body>
  <div id="content">
    <div id="main">
      <nav id="breadcrumbs">
        <a href="..">Noblit</a>
         › <a href="./">Development</a> 
         › <a href="./">Building</a> 
        <a id="repo-link" href="https://github.com/ruuda/noblit/">GitHub</a>
      </nav>
      <article>
        <h1 id="building">Building</h1>
<p>Noblit is a native library written in Rust. It will come with official client
libraries for Haskell, Python, and Rust.</p>
<p><em>The Haskell client is under construction; the Rust and Python clients do not
yet exist.</em></p>
<h2 id="build-tools">Build tools</h2>
<p><a href="https://nixos.org/nix/">Nix</a> can set up a build environment in which all required build tools are
available. The repository contains a <code>default.nix</code> file that defines the
environment. All build tools are pinned for reproducibility. The Nix environment
is used for <abbr>CI</abbr>, so it is actively tested.</p>
<p>There are three ways to use the build environment:</p>
<ul>
<li>Enter a shell in which all build tools are available with <code>nix run -c $SHELL</code>.</li>
<li>Prefix all commands with <code>nix run -c</code>.</li>
<li>Bring the binaries into your <abbr>PATH</abbr> with
    <code>export PATH=$(nix-build --no-out-link)/bin:$PATH</code>.</li>
</ul>
<p>Using Nix is convenient, but not a requirement. You can source your build tools
elsewhere if you like.</p>
<h2 id="noblit">Noblit</h2>
<p>Noblit builds with Rust’s build tool Cargo. Noblit is developed and tested
against Rust 1.28.0, because this was the Rust version that the latest two
Ubuntu LTSes as well as Debian Testing shipped at the time of its inception.
Later versions of Rust may work. Noblit has no dependencies apart from the Rust
standard library.</p>
<p>To build:</p>
<pre><code>$ cargo build --release
$ ls target/release/libnoblit*
</code></pre>
<p>This will have produced three libraries:</p>
<ul>
<li><code>libnoblit.so</code>, for dynamic linking against the C interface.</li>
<li><code>libnoblit.a</code>, for static linking against the C interface.</li>
<li><code>libnoblit.rlib</code>, for use in Rust programs.</li>
</ul>
<p>If you need a header file, a script can generate one from the
<a href="../reference/c/">C interface documentation</a>:</p>
<pre><code>$ libnoblit/gen_header.py &gt; noblit.h
</code></pre>
<h2 id="haskell-client">Haskell client</h2>
<p>The Haskell client is located in <code>client/haskell</code> and builds with Stack.
Currently the library supports Stackage LTS 13 (GHC 8.6). To build:</p>
<pre><code>$ cd client/haskell
$ stack setup
$ stack build
</code></pre>
<p>TODO: How does it find the Rust lib?
TODO: How to use in an application?</p>
<h2 id="python-client">Python client</h2>
<p>The Python client is located in <code>client/python</code>. It loads <code>libnoblit.so</code> using
Python’s <code>ctypes</code> module. If loading fails for the unqualified path, the library
tries to load from <code>target/debug</code> and <code>target/release</code> to aid local development.
Python code does not need to be compiled, but it can be typechecked by
<a href="https://mypy.readthedocs.io/en/stable/">Mypy</a>:</p>
<pre><code>$ mypy --strict client/python
</code></pre>
<h2 id="rust-client">Rust client</h2>
<p>Rust programs can use the <code>noblit</code> crate in the <code>noblit</code> directory directly,
although that exposes internals, and building queries is neithere convenient
nor type safe. It would be nice to add a layer on top that hides most of the
internals and exposes a more user-focused interface, but such a Rust client
does not yet exist.</p>
      </article>
      <nav id="nav-prev-next">
        <a id="nav-prev" href="../reference/c/" title="C API reference">Previous</a>
        <a id="nav-next" href="../golden-tests/" title="Golden tests">Next</a>
        </nav>
      </div>
    <aside>
      <nav>
        <ul>
        <li class="toc-section"><a href="..">Overview</a></li>
          <li class="toc-section
            "><a href="../data-model/">Concepts</a></li>
          
            <li class="toc-chapter
              "><a href="../data-model/">Data model</a></li>
            
            <li class="toc-chapter
              "><a href="../query/">Query</a></li>
            
            <li class="toc-chapter
              "><a href="../query-planning/">Query planning</a></li>
            <li class="toc-section
            "><a href="../examples/bug-tracker/">Examples</a></li>
          
            <li class="toc-chapter
              "><a href="../examples/bug-tracker/">Bug tracker</a></li>
            <li class="toc-section
            "><a href="../reference/rust/">Reference</a></li>
          
            <li class="toc-chapter
              "><a href="../reference/rust/">Rust API reference</a></li>
            
            <li class="toc-chapter
              "><a href="../reference/c/">C API reference</a></li>
            <li class="toc-section
            "><a href="./">Development</a></li>
          
            <li class="toc-chapter
               current"><a href="./">Building</a></li>
            <li><ul>
                <li class="toc-heading"><a href="#build-tools">Build tools</a></li>
                <li class="toc-heading"><a href="#noblit">Noblit</a></li>
                <li class="toc-heading"><a href="#haskell-client">Haskell client</a></li>
                <li class="toc-heading"><a href="#python-client">Python client</a></li>
                <li class="toc-heading"><a href="#rust-client">Rust client</a></li>
                </ul></li>
               
            <li class="toc-chapter
              "><a href="../golden-tests/">Golden tests</a></li>
            
            <li class="toc-chapter
              "><a href="../fuzz-tests/">Fuzz tests</a></li>
            
            <li class="toc-chapter
              "><a href="../resources/">Resources</a></li>
            <li class="toc-section
            "><a href="../files/">Internals</a></li>
          
            <li class="toc-chapter
              "><a href="../files/">Files</a></li>
            
            <li class="toc-chapter
              "><a href="../htree/">Trees</a></li>
            
            <li class="toc-chapter
              "><a href="../execution/">Execution</a></li>
            
            <li class="toc-chapter
              "><a href="../query-optimization/">Query optimization</a></li>
            </ul>
      </nav>
    </aside>
  </div>
</body>
</html>