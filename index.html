
<!DOCTYPE html>
<html>
<head>
  <!--
    Kilsbergen MkDocs theme copyright 2019 Ruud van Asseldonk.
    Licensed under the Apache 2.0 license.
    See https://github.com/ruuda/kilsbergen.
  -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Overview — Noblit</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500" rel="stylesheet">
  <style>
  /* The Inter font family, see https://rsms.me/inter.
     https://rsms.me/inter/#faq-cdn suggests that linking these files directly is fine.
  */
  @font-face {
    font-family: Inter;
    font-style:  normal;
    font-weight: 400;
    src: url("https://rsms.me/inter/font-files/Inter-Regular.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-Regular.woff?v=3.11") format("woff");
  }
  @font-face {
    font-family: Inter;
    font-style:  italic;
    font-weight: 400;
    src: url("https://rsms.me/inter/font-files/Inter-Italic.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-Italic.woff?v=3.11") format("woff");
  }
  @font-face {
    font-family: Inter;
    font-style:  normal;
    font-weight: 500;
    src: url("https://rsms.me/inter/font-files/Inter-Medium.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-Medium.woff?v=3.11") format("woff");
  }
  @font-face {
    font-family: Inter;
    font-style:  normal;
    font-weight: 600;
    src: url("https://rsms.me/inter/font-files/Inter-SemiBold.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-SemiBold.woff?v=3.11") format("woff");
  }
  @font-face {
    font-family: Inter;
    font-style:  normal;
    font-weight: 700;
    src: url("https://rsms.me/inter/font-files/Inter-Bold.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-Bold.woff?v=3.11") format("woff");
  }
  /* Modular scale with exponent 1.7^(1/3). The 1.7 was chosen as the line hight
     that goes well with Inter. Previously I used 1.59, but it was just too tight.
     0.59em
     0.70em
     1.00em
     1.19em
     1.42em
     1.70em
     2.02em
     2.42em
  */
  * { margin: 0; padding: 0; border-spacing: 0; }
  html {
    font-family: Inter, Roboto, sans-serif;
    /*
    Turn on character variant 8 for Inter, which puts serifs on the uppercase I.
    Also turn on variant 1, which has a curved 1.
    Disable contextual alternates for now. There is a bug, either in Inter or
    in Chrome (https://crbug.com/1046095) that causes colons after a <strong> to
    be raised above the baseline.
    */
    font-feature-settings: 'cv01' 1, 'cv08' 1, 'calt' 0;

    font-size: 16px;
    line-height: 1.7em;
    background-color: #fff;
    height: 100%;
  }
  body {
    height: 100%;
  }
  #content {
    display: grid;
    grid-template-columns: auto 16rem 50rem auto;
    color: #333;
    min-height: 100%;
  }
  #main {
    grid-area: 1 / 3 / 2 / 4;
    padding: 2.2rem;
    padding-left: 4rem;
    padding-right: 4rem;
    overflow: hidden;
  }
  #breadcrumbs {
    margin-bottom: 3rem;
    word-spacing: 0.3em;
    color: #78a;
  }
  #breadcrumbs a {
    word-spacing: 0;
    color: #78a;
  }
  article {
    margin-top: 1.3rem;
  }
  h1, h2, h3 {
    font-weight: 600;
    font-size: 1rem;
    color: #444;
  }
  h1 {
    font-size: 2rem;
    margin-bottom: 2.1rem;
  }
  h2 {
    font-size: 1.42rem;
    margin-top: 3.5rem;
    margin-bottom: 1.6rem;
  }
  h3 {
    margin-bottom: 1.42rem;
  }
  code {
    font-family: 'Roboto Mono', monospace;
    font-size: 0.84rem;
    line-height: 1.5rem;
  }
  h3 > code {
    /* Roboto Mono 500 is about as heavy as Inter semibold (600). */
    font-weight: 500;
  }
  abbr {
    text-transform: uppercase;
    /* Downsize so caps are x-height, and compensate weight loss. */
    font-size: 0.78rem;
    font-weight: 500;
    letter-spacing: 0.05rem;
    /* Prevent abbrs from changing the line height of lines in which they occur. */
    line-height: 0;
  }
  sub, sup {
    /* Don't disturb the line height of normal text. */
    line-height: 0rem;
    font-size: 0.78rem;
    font-weight: 500;
  }
  p > code,
  a > code,
  h3 > code,
  li > code,
  td > code {
    background-color: #f0f0f0;
    padding: 0.13rem;
    padding-left: 0.3rem;
    padding-right: 0.3rem;
    border-radius: 0.2rem;
    line-height: 1rem;
  }
  h3 {
    margin-top: 2.29rem;
    margin-bottom: 0.89rem;
  }
  h3 > code {
    margin-left: -0.1rem;
  }
  a {
    color: #36d;
    text-decoration: none;
  }
  p, ul, ol, pre, table {
    /* Same space as line height, leave exactly one line blank. */
    margin-bottom: 1.7rem;
  }
  pre {
    padding-top: 0.8rem;
    padding-bottom: 0.9rem;
    padding-left: 1.19rem;
    padding-right: 0;
    background-color: #f8f8f8;
    border-radius: 0 0.2rem 0.2rem 0;
    border-left: 0.3rem solid #d5d8e0;
    overflow-x: auto;
  }
  pre > code {
    margin-right: 1.41rem;
    color: #555;
  }
  ul, ol {
    list-style-type: none;
    counter-reset: item;
  }
  table {
    font-variant-numeric: tabular-nums;
  }
  th, td {
    padding-right: 2rem;
  }
  th {
    text-align: left;
  }
  td > img {
    display: block;
    padding-top: 1em;
    padding-bottom: 1em;
  }
  #main ul li:before {
    color: #555;
    content: '\2022';
    display: inline-block;
    font-weight: 700;
    margin-left: -0.9rem;
    width: 0.9rem;
  }
  #main ul li {
    margin-left: 0.87rem;
  }
  #main ol li:before {
    content: counter(item);
    display: inline-block;
    font-weight: 700;
    width: 0.8rem;
    margin-left: -1.6rem;
    padding-right: 0.8rem;
  }
  #main ol li {
    margin-left: 1.6rem;
    counter-increment: item;
  }
  #nav-prev-next {
    margin-top: 3.4rem;
    padding-bottom: 3.3rem;
  }
  #nav-prev, #nav-next, #repo-link {
    display: inline-block;
  }
  #nav-prev {
    float: left;
  }
  #nav-next, #repo-link {
    float: right;
    text-align: right;
  }
  #nav-prev::before {
    content: '\219e';
    padding-right: 0.5em;
  }
  #nav-next::after {
    content: '\21a0';
    padding-left: 0.5em;
  }
  aside {
    grid-area: 1 / 1 / 2 / 3;
    border-right: 1px solid #eee;
    background-color: #fafafa;
  }
  aside nav {
    margin-top: 9rem;
    padding-bottom: 3.4rem;
    width: 14rem;
    float: right;
    /* Put the active chapter border over the sidebar border. */
    margin-right: -1px;
  }
  aside a {
    color: #78a;
  }
  aside .toc-section {
    font-weight: 700;
  }
  aside ul {
    margin-bottom: 0;
  }
  aside li ul {
    padding-top: 0.6rem;
    padding-bottom: 1.1rem;
  }
  aside li.toc-section {
    padding-top: 1.7rem;
  }
  aside li.toc-section a {
    color: #36d;
  }
  aside li.current, aside li ul {
    border-right: 0.3em solid #d5d8e0;
    padding-left: 1em;
    margin-left: -1em;
  }
  aside .current a {
    font-weight: 600;
  }
  aside li.toc-heading {
    padding-left: 1em;
  }

  @media(max-width: 63rem)
  {
    #content {
      /* Manual implementation of max-width: on narrower viewports,
         auto-size the body. */
      grid-template-columns: 0 16rem auto 0;
    }
  }

  @media(max-width: 1150px)
  {
    html { font-size: 15px; }
  }

  /* Move the sidebar TOC below content at small widths. */
  @media(max-width: 800px)
  {
    #content {
      display: block;
    }
    aside {
      border-top: 1px solid #eee;
      border-right: 0px none;
    }
    aside nav {
      margin-left: 4em;
      margin-top: 1.7em;
      float: none;
    }
    #main {
      padding-bottom: 1.7em;
    }
    aside li.current, aside li ul {
      border-right: 0px none;
    }
  }

  /* Use less generous margins for very narrow viewports. */
  @media(max-width: 650px)
  {
    #main {
      padding-left: 2rem;
      padding-right: 2rem;
    }
    aside nav {
      margin-left: 2rem;
      padding-bottom: 2rem;
    }
  }

  @media(max-width: 450px)
  {
    #main {
      padding-left: 1.7em;
      padding-right: 1.7em;
    }
    aside nav {
      margin-left: 1.7em;
    }
  }
  </style>
</head>
<body>
  <div id="content">
    <div id="main">
      <nav id="breadcrumbs">
        <a href=".">Noblit</a>
        › <a href=".">Overview</a>
  <a id="repo-link" href="https://github.com/ruuda/noblit/">GitHub</a>
      </nav>
      <article>
        <h1 id="noblit">Noblit</h1>
<p><em>Vaporware warning: much of the content below is hypothetical.</em></p>
<p>Noblit is an embeddable append-only database. The database records a history
of immutable (entity, attribute, value) tuples. Tuples can be asserted and
retracted. A retraction is recorded as a new fact; it is not a delete. Any
historical state of the database can be reproduced, and the history is
first-class and queryable.</p>
<h2 id="features">Features</h2>
<ul>
<li><strong>Embeddable.</strong> Noblit comes as a library that you link into your
   application. Global installation or daemons are not necessary.</li>
<li><strong>Simple but flexible data model.</strong>
   Noblit stores (entity, attribute, value) tuples. A traditional relational
   model can be expressed like this, but less rigid structures such as graphs
   can be expressed too.</li>
<li><strong>Machine-friendly relational queries.</strong> Queries are data structures rather
   than strings. There is no need for string formatting or escaping, and the
   full power of the host language is available to safely generate and compose
   queries.</li>
<li><strong>Point in time queries.</strong>
   Any historical state of the database can be reproduced and queried
   efficiently.</li>
<li><strong>Reified schema</strong>.
   Noblit stores the schema as entities in the database itself. The schema can
   be evolved through normal assertions and retractions, and the full migration
   history is available.</li>
<li><strong>Reified transactions</strong>.
   Transactions in Noblit are entities that can have attributes like any other
   entity. Possibilities include the transaction timestamp and the user who
   initiated the transaction. Transactions can be inspected in queries.</li>
<li><strong>Profile-guided query optimization</strong>.
   While queries are declarative, statement order affects the query plan. An
   explicit query optimizer can optimize a given query by measuring how
   alternatives perform, instead of having to estimate from statistics.</li>
</ul>
<h2 id="comparison">Comparison</h2>
<p>Noblit is heavily inspired by <a href="https://www.datomic.com/">Datomic</a>, especially by its data model.
In comparison to other databases such as <a href="https://sqlite.org/index.html">SQLite</a> and
<a href="https://www.postgresql.org/about/">Postgres</a>, Noblit positions itself as follows:</p>
<table>
<thead>
<tr>
<th></th>
<th>Client-server</th>
<th>Embedded</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Mutable</strong></td>
<td>Postgres</td>
<td>SQLite</td>
</tr>
<tr>
<td><strong>Immutable</strong></td>
<td>Datomic</td>
<td><em>Noblit</em></td>
</tr>
</tbody>
</table>
<p>Noblit combines the low operational overhead of an embedded database with the
simplicity of an append-only database with value semantics.</p>
<p>In comparison to Datomic, Noblit puts more focus on static type safety. This
makes schemas more rigid. On the one hand this impedes iterating quickly, but on
the other hand it helps to provide data consistency in the long term. Datomic
is a distributed system running on the <abbr>JVM</abbr>, while Noblit is a small
native library.</p>
<p>Another attempt at an embedded database inspired by Datomic was <a href="https://github.com/mozilla/mentat">Mentat</a>.
Both Noblit and Mentat happen to be written in Rust. Mentat is a layer on top of
SQLite, whereas Noblit has its own storage backend. Mentat exists but is
unmaintained, Noblit is vaporware.</p>
<h2 id="goals">Goals</h2>
<ul>
<li>An embeddable library for queries and transactions.</li>
<li>Enabling — but not requiring — a client-server database on top of the library,
   with a single transactor and scale-out reads.</li>
<li>Storing datasets that do not fit in working memory. The result of a query and
   data to insert must fit though.</li>
<li>Handling moderate write workloads and moderately sized data.</li>
<li>Relational queries in a machine-first query format.</li>
<li>Simplicity. First make it work, then make it fast. I am writing this down to
   remind myself to not micro-optimize. Complications should be justified by
   profiling measurements.</li>
<li>Easy to build, few or zero dependencies.</li>
</ul>
<h2 id="non-goals">Non-goals</h2>
<ul>
<li>Deleting data or updating data in place.</li>
<li>Writing large values (say, larger than 64 KiB). A key-value store or document
   store might be better suited for this.</li>
<li>High write throughput. If you produce large volumes of data quickly, probably
   not all of it remains valuable for a long time, and storage space might
   become a concern. A time series database or durable message queue might be
   a better alternative.</li>
<li>Having the fastest lookups. A key-value store may be better suited for this.</li>
<li>Portability. Little-endian architectures that run Linux are the only target.</li>
</ul>
      </article>
      <nav id="nav-prev-next">
        <a id="nav-next" href="data-model/" title="Data model">Next</a>
        </nav>
      </div>
    <aside>
      <nav>
        <ul>
        <li class="toc-section"><a href=".">Overview</a></li>
          <li class="toc-section"><a href="data-model/">Concepts</a></li>
          <li class="toc-chapter
              "><a href="data-model/">Data model</a></li>
            <li class="toc-chapter
              "><a href="query/">Query</a></li>
            <li class="toc-chapter
              "><a href="query-planning/">Query planning</a></li>
            <li class="toc-section"><a href="examples/bug-tracker/">Examples</a></li>
          <li class="toc-chapter
              "><a href="examples/bug-tracker/">Bug tracker</a></li>
            <li class="toc-section"><a href="building/">Development</a></li>
          <li class="toc-chapter
              "><a href="building/">Building</a></li>
            <li class="toc-chapter
              "><a href="golden-tests/">Golden tests</a></li>
            <li class="toc-chapter
              "><a href="resources/">Resources</a></li>
            <li class="toc-section"><a href="files/">Internals</a></li>
          <li class="toc-chapter
              "><a href="files/">Files</a></li>
            <li class="toc-chapter
              "><a href="htree/">Trees</a></li>
            <li class="toc-chapter
              "><a href="execution/">Execution</a></li>
            <li class="toc-chapter
              "><a href="query-optimization/">Query optimization</a></li>
            </ul>
      </nav>
    </aside>
  </div>
</body>
</html>